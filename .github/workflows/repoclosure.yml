name: Repoclosure

on:
  workflow_dispatch:
  schedule:
    - cron: "25 9 * * *"

jobs:
  repoclosure:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        version:
          - rawhide
          - 44
          - 43
          - 42
    container:
      image: registry.fedoraproject.org/fedora:${{ matrix.version }}
    steps:
      - name: Prepare
        run: |
          cat << 'EOF' >> /etc/yum.repos.d/coprs.repo
          [copr:copr.fedorainfracloud.org:hermitfeather:hyprland]
          name=Copr repo for hyprland owned by hermitfeather
          baseurl=https://download.copr.fedorainfracloud.org/results/hermitfeather/hyprland/fedora-$releasever-$basearch/
          type=rpm-md
          skip_if_unavailable=True
          gpgcheck=1
          gpgkey=https://download.copr.fedorainfracloud.org/results/hermitfeather/hyprland/pubkey.gpg
          repo_gpgcheck=0
          enabled=1
          enabled_metadata=1
          EOF

      - name: Repoclosure
        run: |
          dnf repoclosure \
            --check copr:copr.fedorainfracloud.org:hermitfeather:hyprland \
            --newest

      - name: Repoclosure (with --best)
        run: |
          dnf repoclosure \
            --check copr:copr.fedorainfracloud.org:hermitfeather:hyprland \
            --newest --best
